<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="utf-8">
    <title>Cadastro de Usuário</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>

<body>

<header class="header-cadastro-usuario">
    <h1 class="titulo-cadastro-usuario">Cadastro de Usuário</h1>
</header>

<section>
    <div class="div-botao-topo">
        <button class="botao-topo" type="submit">Retornar</button>
    </div>
    <br>

    <form th:action="@{/save}" th:object="${user}" method="post" onsubmit="return validatePassword()">
        <div class="form-group">
            <label for="username">Nome de Usuário:</label>
            <input class="name-input" type="text" id="username" th:field="*{username}" required>
        </div>
        <br>
        <div>
            <label for="CPF">CPF:</label>
            <input type="text" id="CPF" th:field="*{CPF}"  required placeholder="000.000.000-00" onkeyup="formatarCPF(this)">
        </div>
        <br>

        <div>
            <label for="telefone">Telefone:</label>
            <input type="text" id="telefone" th:field="*{telefone}"  required placeholder="(00)00000-0000" onkeyup="formatarTelefone(this)" maxlength="15">
        </div>
        <br>

        <div>
            <label for="cep">CEP:</label>
            <input type="text" id="cep" th:field="*{cep}" required placeholder="00000-000" maxlength="9" onkeyup="formatarCEP(this)" >
            <button type="button" onclick="buscarCEP()">Buscar CEP</button>
        </div>

        <div>
            <label for="endereco">Endereço:</label>
            <input type="text" id="endereco" th:field="*{endereco}"  required>
        </div>
        <br>

        <div>
            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" th:field="*{bairro}"  required>
        </div>
        <br>

        <div>
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" th:field="*{cidade}"  required>
        </div>
        <br>

        <div>
            <label for="uf">UF:</label>
            <input type="text" id="uf" th:field="*{uf}"  required>
        </div>
        <br>

        <div class="form-group">
            <label for="password">Senha:</label>
            <input type="password" id="password" th:field="*{password}" required>
        </div>
        <br>

        <div class="form-group">
            <label for="confirmPassword">Confirmar Senha:</label>
            <input type="password" id="confirmPassword" required>
        </div>
        <br>

        <button th:class="botao-form" type="submit">Cadastrar</button>
    </form>

    <!-- Validação de Senha -->
    <script>
        function validatePassword() {
            let password = document.getElementById("password").value;
            let confirmPassword = document.getElementById("confirmPassword").value;
            let errorMessage = document.getElementById("errorMessage");

            if (password !== confirmPassword) {
                errorMessage.textContent = "As senhas não coincidem!";
                return false;
            }

            errorMessage.textContent = "";
            return true;
        }

         function buscarCEP() {
    let cep = document.getElementById("cep").value.replace(/\D/g, '');

    if (cep.length !== 8) {
        alert("Digite um CEP válido no formato 00000-000!");
        return;
    }

    fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(response => response.json())
        .then(data => {
            if (!data.erro) {
                document.getElementById("endereco").value = data.logradouro;
                document.getElementById("bairro").value = data.bairro;
                document.getElementById("cidade").value = data.localidade;
                document.getElementById("uf").value = data.uf;
            } else {
                alert("CEP não encontrado!");
            }
        })
        .catch(error => console.error("Erro ao buscar CEP:", error));
}
        function formatarCPF(campo) {
            let cpf = campo.value.replace(/\D/g, '');
            if (cpf.length > 11) cpf = cpf.slice(0, 11);
            let cpfFormatado = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
            campo.value = cpfFormatado;
        }
        function formatarCEP(campo) {
            let cep = campo.value.replace(/\D/g, '');
            if (cep.length > 8) cep = cep.slice(0, 8);
            let cepFormatado = cep.replace(/^(\d{5})(\d{3})/, "$1-$2");
            campo.value = cepFormatado;
}

        function formatarTelefone(campo) {
            let telefone = campo.value.replace(/\D/g, '');
            if (telefone.length > 11) telefone = telefone.slice(0, 11);
            let telefoneFormatado = telefone.length > 10
                ? `(${telefone.slice(0, 2)}) ${telefone.slice(2, 7)}-${telefone.slice(7)}`
                : `(${telefone.slice(0, 2)}) ${telefone.slice(2, 6)}-${telefone.slice(6)}`;
            campo.value = telefoneFormatado;
        }
    </script>

    <p th:if="${message}" th:text="${message}" style="color: green; text-align: center; font-size: 18px;"></p>
    <p id="errorMessage" style="color: red; text-align: center; font-size: 18px;"></p>

</section>
</body>

</html>
